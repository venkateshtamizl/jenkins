import{j as u,r as c,R as m}from"./PipelineGraphModel-BDP0LgOb.js";function g(n){const t=/^\u001b\[([;0-9]*)m$/,e={isSelectGraphicRendition:!1,escapeCode:n},s=t.exec(n);if(s){e.isSelectGraphicRendition=!0,e.setFG=!1,e.setBG=!1,e.resetFG=!1,e.resetBG=!1;const r=(s[1]||"").split(";").map(l=>parseInt(l||"0"));for(const l of r)l>=30&&l<=37?e.setFG=l-30:l>=40&&l<=47?e.setBG=l-40:((l===38||l===0)&&(e.resetFG=!0,e.setFG=!1),(l===48||l===0)&&(e.resetBG=!0,e.setBG=!1))}return e}function b(n){if(typeof n!="string")return[];const t=n.length;if(t===0)return[];let e=0,s=0,r=0,l=0,o=0;const f=[];for(;e<t&&(s=n.indexOf("\x1B",e),s!==-1);){if(l=n.indexOf("<!--",e),o=n.indexOf("-->",l),o!==-1&&(o+=3),s>l&&s<o){e=o;continue}s>e&&(f.push(n.substring(e,s)),e=s),s+=2;let i=n.charCodeAt(s);for(;s<t&&(i<64||i>126);)s++,i=n.charCodeAt(s);const a=g(n.substring(e,s+1));f.push(a),e=s+1,r=e}return r<t&&f.push(n.substr(r)),f}function B(n,t){const e=[];let s={setFG:!1,setBG:!1};for(let r=0;r<n.length;r++){const l=n[r];if(typeof l=="string")if(!s.setFG&&!s.setBG)e.push(u.jsx("div",{dangerouslySetInnerHTML:{__html:l}},`${t}-${r}`));else{const o=[];typeof s.setFG=="number"&&o.push(`ansi-fg-${s.setFG}`),typeof s.setBG=="number"&&o.push(`ansi-bg-${s.setBG}`),e.push(u.jsx("span",{className:o.join(" "),children:l}))}else if(l.isSelectGraphicRendition){const o={...s};l.resetFG&&(o.setFG=!1),l.resetBG&&(o.setBG=!1),typeof l.setFG=="number"&&(o.setFG=l.setFG),typeof l.setBG=="number"&&(o.setBG=l.setBG),s=o}}return e}const G=c.memo(function(t){const e=c.useRef(null);return c.useEffect(()=>{const s=e.current?e.current.getBoundingClientRect().height:0;t.heightCallback(s),window.Behaviour.applySubtree(document.getElementById(`${t.stepId}-${t.lineNumber}`))},[]),u.jsx("pre",{style:{background:"none",border:"none"},className:"console-output-line",children:u.jsxs("div",{className:"console-output-line",ref:e,children:[u.jsx("a",{className:"console-line-number",id:`log-${t.lineNumber}`,href:`?start-byte=${t.startByte}&selected-node=${t.stepId}#log-${t.lineNumber}`,style:{width:Math.max(9*String(t.lineNumber).length,30)+"px"},children:t.lineNumber}),u.jsx("div",{id:`${t.stepId}-${t.lineNumber}`,className:"console-text",children:B(b(t.content),`${t.stepId}-${t.lineNumber}`)})]},`${t.lineNumber}-body`)},`console-line-pre${t.lineNumber}`)});function y(n){const t=c.useRef(null),[e,s]=c.useState(!1),[r,l]=c.useState(1);c.useEffect(()=>()=>{t.current&&clearInterval(t.current)},[]),c.useEffect(()=>{e&&n.logBuffer.lines.length>0&&n.logBuffer.lines&&requestAnimationFrame(()=>{const i=document.documentElement.scrollHeight;window.scrollTo({top:i})})},[n.logBuffer.lines]),c.useEffect(()=>{const i=()=>{const a=window.scrollY+window.innerHeight,h=document.body.scrollHeight-a<300;s(h)};return window.addEventListener("scroll",i),()=>window.removeEventListener("scroll",i)},[]),c.useEffect(()=>{e&&f()?t.current||(t.current=setInterval(()=>{n.onMoreConsoleClick(n.step.id,n.logBuffer.startByte)},1e3)):t.current&&(clearInterval(t.current),t.current=null)},[e,n.step,n.logBuffer]);const o=c.useCallback(i=>{(i>r||r===1)&&l(i)},[r]),f=()=>n.step.state===m.running||n.logBuffer.startByte<0;return c.useEffect(()=>{const i=window.location.hash;if(!i.startsWith("#log-"))return;const a=parseInt(i.substring(5));if(!isNaN(a)){const d=document.getElementById(`log-${a}`);if(d){d.scrollIntoView({behavior:"smooth",block:"center"});const h=location.hash;location.hash="",location.hash=h}}},[]),u.jsx("div",{role:"log",children:n.logBuffer.lines.map((i,a)=>u.jsx(G,{lineNumber:String(a),content:i,stepId:n.step.id,startByte:n.logBuffer.startByte,heightCallback:o},a))})}export{y as default};
//# sourceMappingURL=ConsoleLogStream-D8ITUXhA.js.map
